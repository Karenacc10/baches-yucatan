generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}
datasource db {
  provider = "postgresql"
  // Connection URL moved to prisma.config.ts per Prisma v7; see https://pris.ly/d/config-datasource
}
model Report {
  id                 String       @id @default(uuid())
  // üìç Campos del lugar (en vez de otra tabla)
  latitude           Float
  longitude          Float
  street             String?
  neighborhood       String?   // colonia o zona
  city               String?
  state              String?
  postalCode         String?
  description        String?   // texto libre sobre el lugar

  date               DateTime
  reportedByVehicle  Vehicle?     @relation("VehicleReports", fields: [reportedByVehicleId], references: [id])
  reportedByVehicleId String?
  reportedByWorker   Worker?      @relation(fields: [reportedByWorkerId], references: [id])
  reportedByWorkerId String?
  status             ReportStatus @default(reported)
  severity           Severity
  comments           String?
  images             String[]
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
}

model Vehicle {
  id                 String        @id @default(uuid())
  licensePlate       String        @unique
  model              String?
  year               Int?
  color              String?
  corporation        String?
  assignedWorker     Worker?       @relation(fields: [assignedWorkerId], references: [id])
  assignedWorkerId   String?
  assignerWorkersIds String[]
  status             VehicleStatus @default(active)
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt

  reports            Report[]      @relation("VehicleReports")
  assignments        Assignment[]
}

model Worker {
  id               String        @id @default(uuid())
  role             Role
  email            String        @unique
  passwordHash     String
  name             String
  secondName       String?
  lastname         String
  secondLastname   String
  phoneNumber      Int
  fechaNacimiento  DateTime
  status           WorkerStatus  @default(active)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  photoUrl         String?

  vehicleAssigned  Vehicle[]
  reports          Report[]
  assignments      Assignment[]
}

model Assignment {
  id              String             @id @default(uuid())
  // reportIds converted to relation AssignmentReport if needed
  // reportIds       Json               // guarda array de objetos tipo ReportAndProgress
  teamId          Int?
  worker          Worker             @relation(fields: [workerId], references: [id])
  workerId        String
  vehicle         Vehicle?           @relation(fields: [vehicleId], references: [id])
  vehicleId       String?
  assignedAt      DateTime?          @default(now())
  completedAt     DateTime?
  progressStatus  ProgressStatus     @default(not_started)
  priority        Priority           @default(medium)
  notes           String?
}

enum Role {
  admin
  supervisor
  worker
}

enum ReportStatus {
  reported
  in_progress
  resolved
}

enum Severity {
  low
  medium
  high
}

enum VehicleStatus {
  active
  inactive
  maintenance
}

enum WorkerStatus {
  active
  inactive
  suspended
}

enum ProgressStatus {
  not_started
  in_progress
  completed
  on_hold
}

enum Priority {
  low
  medium
  high
}
