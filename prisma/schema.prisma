datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

//BASE DE DATOS PARA GESTION DE BACHES

model Report {
  id                  String        @id @default(uuid())

  latitude            Float
  longitude           Float
  street              String?
  neighborhood        String?
  city                String?
  state               String?
  postalCode          String?
  description         String?

  date                DateTime

  reportedByVehicle   Vehicle?      @relation("VehicleReports", fields: [reportedByVehicleId], references: [id])
  reportedByVehicleId String?

  reportedByWorker    Worker?       @relation("WorkerReports", fields: [reportedByWorkerId], references: [id])
  reportedByWorkerId  String?

  status              ReportStatus  @default(reported)
  severity            Severity
  comments            String?
  images              String[]

  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
}


model Vehicle {
  id                 String        @id @default(uuid())
  licensePlate       String        @unique
  model              String?
  year               Int?
  color              String?
  corporation        String?

  // ❗ Ya NO tiene assignedWorker directo
  // Ahora las asignaciones se manejan por la tabla Assignment (historial)

  assignerWorkersIds String[]

  status             VehicleStatus @default(active)
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt

  reports            Report[]      @relation("VehicleReports")

  // ⬇ Historial de asignaciones
  assignments        Assignment[]
}


model Worker {
  id                String        @id @default(uuid())
  role              Role
  email             String        @unique
  passwordHash      String
  name              String
  secondName        String?
  lastname          String
  secondLastname    String
  phoneNumber       Int
  fechaNacimiento   DateTime

  status            WorkerStatus  @default(active)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  photoUrl          String?

  reports           Report[]      @relation("WorkerReports")

  // ⬇ Historial de asignaciones
  assignments       Assignment[]
}


model Assignment {
  id              String          @id @default(uuid())

  worker          Worker          @relation(fields: [workerId], references: [id])
  workerId        String

  vehicle         Vehicle         @relation(fields: [vehicleId], references: [id])
  vehicleId       String

  assignedAt      DateTime        @default(now())
  completedAt     DateTime?

  // ⬇ Estado de progreso del reporte
  progressStatus  ProgressStatus  @default(not_started)

  priority        Priority        @default(medium)
  active          Boolean         @default(true) // ❗ Importante
  notes           String?
}


enum Role {
  admin
  supervisor
  worker
}

enum ReportStatus {
  reported
  in_progress
  resolved
}

enum Severity {
  low
  medium
  high
}

enum VehicleStatus {
  active
  inactive
  maintenance
}

enum WorkerStatus {
  active
  inactive
  suspended
}

enum ProgressStatus {
  not_started
  in_progress
  completed
  on_hold
}

enum Priority {
  low
  medium
  high
}